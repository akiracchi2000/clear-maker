const README_CONTENT="# Clear Maker\n\n**AIã‚’æ´»ç”¨ã—ãŸç­”æ¡ˆæ·»å‰Šãƒ»è§£èª¬ä½œæˆæ”¯æ´ãƒ„ãƒ¼ãƒ«**\n\nClear Makerã¯ã€Google Gemini Proãƒ¢ãƒ‡ãƒ«ã‚’æ´»ç”¨ã—ã¦ã€ç”Ÿå¾’ã®ç­”æ¡ˆã€æ¨¡ç¯„è§£ç­”ã€å•é¡Œæ–‡ã®ç”»åƒã‚’å…ƒã«ã€é«˜åº¦ãªæ·»å‰Šã¨è§£èª¬ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚\n\n## ä¸»ãªæ©Ÿèƒ½\n\n*   **ç”»åƒè§£æ**: å•é¡Œã€æ¨¡ç¯„è§£ç­”ã€ç”Ÿå¾’ã®ç­”æ¡ˆã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦è§£æã€‚\n*   **AIæ·»å‰Š**: æ±å¤§ãƒ»äº¬å¤§ãƒ¬ãƒ™ãƒ«ã®åŸºæº–ã§ã€è¨˜è¿°ã®è«–ç†æ€§ã‚„è¨ˆç®—éç¨‹ã‚’ç´°ã‹ããƒã‚§ãƒƒã‚¯ã€‚\n*   **ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è²¼ã‚Šä»˜ã‘**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’`Ctrl+V`ã§ç›´æ¥è²¼ã‚Šä»˜ã‘å¯èƒ½ï¼ˆãƒ›ãƒãƒ¼åˆ¤å®šæ©Ÿèƒ½ä»˜ãï¼‰ã€‚\n*   **PDFå¯¾å¿œ**: PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã§ç”»åƒã«å¤‰æ›ã—ã¦èª­ã¿è¾¼ã¿ã€‚\n*   **æ•°å¼å¯¾å¿œ**: LaTeXå½¢å¼ã®æ•°å¼ã‚’ç¾ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆKaTeXä½¿ç”¨ï¼‰ã€‚\n*   **ç·¨é›†æ©Ÿèƒ½**: ç”Ÿæˆã•ã‚ŒãŸè§£èª¬ã‚’ãã®å ´ã§ç·¨é›†ãƒ»ä¿å­˜å¯èƒ½ã€‚\n*   **PWAå¯¾å¿œ**: ã‚¢ãƒ—ãƒªã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½¿ç”¨å¯èƒ½ã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾å¿œã€‚\n*   **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é‡è¦–**: APIã‚­ãƒ¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚\n\n## æ›´æ–°å±¥æ­´ (Changelog)\n\n### v1.5.8 (2026-02-12)\n*   **[ä¿®æ­£] ãƒãƒ‹ãƒ¥ã‚¢ãƒ«è¡¨ç¤ºã®ä¸å…·åˆ**:\n    *   `README.md` ãŒè¡¨ç¤ºã•ã‚Œãªã„å•é¡Œã‚’ä¿®æ­£ã€‚\n    *   ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¯ãƒ©ã‚¹åãŒèª¤ã£ã¦ã„ãŸä¸å…·åˆã‚’ä¿®æ­£ (`modal-overlay` -> `modal`)ã€‚\n    *   ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å•é¡Œã«ã‚ˆã‚Šå¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œç¶šã‘ã‚‹ç¾è±¡ã‚’è§£æ±ºã€‚\n*   **[æ”¹å–„] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®è¦‹ç›´ã—**: Service Workerã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’æœ€é©åŒ–ã€‚\n\n### v1.5.3 (2026-02-12)\n*   **[æ–°æ©Ÿèƒ½] ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è²¼ã‚Šä»˜ã‘æ©Ÿèƒ½ã®å®Ÿè£…**:\n    *   ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ï¼ˆå•é¡Œãƒ»æ¨¡ç¯„è§£ç­”ãƒ»ç”Ÿå¾’è§£ç­”ï¼‰ã®ä¸Šã§è²¼ã‚Šä»˜ã‘æ“ä½œã‚’è¡Œã†ã¨ã€è‡ªå‹•çš„ã«ãã®ã‚¾ãƒ¼ãƒ³ã«ç”»åƒãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚\n    *   ã‚¾ãƒ¼ãƒ³å¤–ã§è²¼ã‚Šä»˜ã‘ãŸå ´åˆã¯ã€æŒ¯ã‚Šåˆ†ã‘å…ˆã‚’é¸æŠã™ã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\n*   **[æ”¹å–„] ã‚³ãƒ¼ãƒ‰ã®å®‰å…¨æ€§å‘ä¸Š**:\n    *   `app.src.js`ï¼ˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼‰ã¨`app.js`ï¼ˆå®Ÿè¡Œç”¨ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’åˆ†é›¢ã€‚\n    *   `app.js`ã«å¯¾ã—ã¦é›£èª­åŒ–å‡¦ç†ã‚’é©ç”¨ã€‚\n*   **[ä¿®æ­£] ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨è¨˜ã®æ›´æ–°**: ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’v1.5.3ã«æ›´æ–°ã€‚\n\n### v1.5.2\n*   **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´**: UIã®ä½¿ã„ã‚„ã™ã•ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ã€‚\n*   **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„**: æ•°å¼å‡ºåŠ›ã®ç²¾åº¦å‘ä¸Šãªã©ã€‚\n\n## APIã‚­ãƒ¼ã®å–å¾—æ–¹æ³•\n\nã“ã®ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Google Gemini APIã‚­ãƒ¼ãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã§ç„¡æ–™ã§å–å¾—ã§ãã¾ã™ã€‚\n\n1.  [Google AI Studio](https://aistudio.google.com/app/apikey) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚\n2.  Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚\n3.  ã€Œ**Create API key**ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚\n4.  ã€Œ**Create API key in new project**ã€ï¼ˆã¾ãŸã¯æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚\n5.  ç”Ÿæˆã•ã‚ŒãŸAPIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼ã—ã€Clear Makerã®è¨­å®šç”»é¢ï¼ˆå³ä¸Šã®âš™ï¸ï¼‰ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n\n## ä½¿ã„æ–¹\n\n1.  å³ä¸Šã®è¨­å®šãƒœã‚¿ãƒ³ï¼ˆâš™ï¸ï¼‰ã‹ã‚‰Gemini APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚\n2.  ã€Œå•é¡Œã€ã€Œæ¨¡ç¯„è§£ç­”ã€ã€Œç”Ÿå¾’ã®ç­”æ¡ˆã€ã®å„ã‚¨ãƒªã‚¢ã«ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚\n3.  ã€Œâœ¨ è§£æã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€AIãŒæ·»å‰Šã¨è§£èª¬ã‚’ç”Ÿæˆã—ã¾ã™ã€‚\n4.  ç”Ÿæˆã•ã‚ŒãŸçµæœã¯ã‚³ãƒ”ãƒ¼ã—ãŸã‚Šã€ç”»åƒã¨ã—ã¦ä¿å­˜ã—ãŸã‚Šã§ãã¾ã™ã€‚\n\n## é–‹ç™ºè€…å‘ã‘æƒ…å ±\n\n*   **`app.src.js`**: é–‹ç™ºç”¨ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆæœªåœ§ç¸®ãƒ»æœªé›£èª­åŒ–ï¼‰ã€‚ç·¨é›†ã¯ã“ã¡ã‚‰ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n*   **`app.js`**: æœ¬ç•ªç”¨ã®å®Ÿè¡Œã‚³ãƒ¼ãƒ‰ï¼ˆé›£èª­åŒ–æ¸ˆã¿ï¼‰ã€‚`app.src.js`ã‹ã‚‰ç”Ÿæˆã•ã‚Œã¾ã™ã€‚\n",elements={dropOverlay:document.getElementById("drop-overlay"),settingsModal:document.getElementById("settings-modal"),openSettingsBtn:document.getElementById("open-settings"),closeSettingsBtn:document.getElementById("close-settings"),saveSettingsBtn:document.getElementById("save-settings"),apiKeyInput:document.getElementById("api-key"),modelSelect:document.getElementById("model-select"),subjectSelect:document.getElementById("subject-select"),systemPrompt:document.getElementById("system-prompt"),userPrompt:document.getElementById("user-prompt"),fileStatus:document.getElementById("file-status"),responseArea:document.getElementById("response-area"),loadingIndicator:document.getElementById("loading-indicator"),generateBtn:document.getElementById("generate-btn"),copyBtn:document.getElementById("copy-btn"),screenshotBtn:document.getElementById("screenshot-btn"),themeToggleBtn:document.getElementById("theme-toggle"),editBtn:document.getElementById("edit-btn"),responseEditor:document.getElementById("response-editor"),editActions:document.getElementById("edit-actions"),saveEditBtn:document.getElementById("save-edit-btn"),cancelEditBtn:document.getElementById("cancel-edit-btn"),pasteModal:document.getElementById("paste-modal"),closePasteBtn:document.getElementById("close-paste-modal"),pasteOptions:document.querySelectorAll(".paste-option-btn"),dropZones:{question:document.getElementById("drop-zone-question"),model:document.getElementById("drop-zone-model"),student:document.getElementById("drop-zone-student")},inputs:{question:document.getElementById("file-input-question"),model:document.getElementById("file-input-model"),student:document.getElementById("file-input-student")},thumbs:{question:document.getElementById("thumbnails-question"),model:document.getElementById("thumbnails-model"),student:document.getElementById("thumbnails-student")}};elements.copyBtn.addEventListener("click",copyResponse),elements.screenshotBtn.addEventListener("click",saveAsImage),elements.editBtn.addEventListener("click",()=>toggleEditMode(!0)),elements.saveEditBtn.addEventListener("click",saveEdit),elements.cancelEditBtn.addEventListener("click",cancelEdit);let state={currentSubject:"other",currentMarkdown:"",hoveredZone:null,pendingPasteFiles:[],theme:"dark",prompts:{},apiKey:"",model:"gemini-3-pro-preview",files:{question:[],model:[],student:[]},isGenerationFinished:!1};const DEFAULT_PROMPTS={math:"æ–‡é ­ã«ã¾ãšã€Œé¦™å·ã§ã™ã€‚æ—©é€Ÿã§ã™ãŒè§£ç­”ã‚’æ·»å‰Šã—ã¾ã™ã­ã€‚ã€ã¨ã„ã†æ–‡è¨€ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ã€‚ã“ã®è¡¨ç¾ã¯æ¯å›è‹¥å¹²å¤‰åŒ–ã•ã›ã¦ï¼ˆä»Šå›ã‚‚é ‘å¼µã£ã¦ã„ãã¾ã—ã‚‡ã†ãªã©ï¼‰ã€‚æ·»å‰Šå¯¾è±¡ã«é–¢ã—ã¦ã¯ã‚³ãƒ¡ãƒ³ãƒˆã—ãªãã¦å¤§ä¸ˆå¤«ã€‚\n\nRole:ã‚ãªãŸã¯æ±å¤§ãƒ»äº¬å¤§ãªã©ã®é›£é–¢å›½ç«‹å¤§å­¦ã®æ•°å­¦ã®æ¡ç‚¹å®˜ã§ã™ã€‚å—é¨“ç”ŸãŒæ›¸ã„ãŸç­”æ¡ˆã‚’ã€è¨˜è¿°è©¦é¨“ã®è¦³ç‚¹ã‹ã‚‰å³ã—ãã€ã‹ã¤å»ºè¨­çš„ã«æ·»å‰Šã—ã¦ãã ã•ã„ã€‚ãŸã ã—ï¼Œè§£ç­”è€…ã®æ„æ¬²ã‚’ããã‚ˆã†ãªè¡¨ç¾ã¯é¿ã‘ï¼ŒåŠ±ã¾ã™è¨€è‘‰ã‚’å¿˜ã‚Œãªã„ã‚ˆã†ã«å¿ƒæ›ã‘ã¦ã»ã—ã„ã€‚\n\nã€é‡è¦ã€‘å¥èª­ç‚¹ã®ãƒã‚§ãƒƒã‚¯: ç­”æ¡ˆå†…ã§ã€Œï¼Œã€ï¼ˆã‚«ãƒ³ãƒï¼‰ã¨ã€Œã€ã€ï¼ˆèª­ç‚¹ï¼‰ãŒæ··åœ¨ã—ã¦ã„ãªã„ã‹ç¢ºèªã—ã€çµ±ä¸€ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€Œã€é …ç›®åˆ¥ãƒã‚§ãƒƒã‚¯ã€‘ã€ã§æŒ‡æ‘˜ã—ã¦ãã ã•ã„ã€‚\n\næ·»å‰Šã®5ã¤ã®è©•ä¾¡ãƒã‚¤ãƒ³ãƒˆ:è«–ç†ã®æ­£ç¢ºæ€§: å‘½é¡Œã®é€†ãƒ»è£ãƒ»å¯¾å¶ã€å¿…è¦ååˆ†æ¡ä»¶ï¼ˆ$\\iff$ï¼‰ã®æ‰±ã„ã«ãƒŸã‚¹ã¯ãªã„ã‹ã€‚è¨ˆç®—ã®éç¨‹: ç­”ãˆã ã‘ã§ãªãã€ç«‹å¼ã®æ ¹æ‹ ãŒæ˜ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã€‚è¨˜è¿°ã®ä¸å¯§ã•: ã€Œï½ã¨ãŠãã€ã€Œï½ã‚ˆã‚Šã€ã¨ã„ã£ãŸæ—¥æœ¬èªã®ã¤ãªããŒè‡ªç„¶ã§ã€ç¬¬ä¸‰è€…ãŒèª­ã‚“ã§ç†è§£ã§ãã‚‹ã‹ã€‚æ¡ä»¶ã®ç¢ºèª: å®šç¾©åŸŸã€åˆ†æ¯ãŒ $0$ ã§ãªã„ã“ã¨ã€åˆ¤åˆ¥å¼ã®ç¬¦å·ã€å¢ƒç•Œç·šã®å«ã¿ãªã©ã€æ•°å­¦çš„ã«å¿…é ˆã®æ¤œè¨ãŒæ¼ã‚Œã¦ã„ãªã„ã‹ã€‚\n\nåˆ¥è§£ãƒ»åŠ¹ç‡æ€§: ã‚ˆã‚Šç°¡æ½”ã€ã‚ã‚‹ã„ã¯ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãªè§£æ³•ãŒã‚ã‚‹å ´åˆã€ãã®ãƒ’ãƒ³ãƒˆã‚’æç¤ºã™ã‚‹ã“ã¨ã€‚\n\nå‡ºåŠ›å½¢å¼:ã€æ­£èª¤ã€‘ã¾ãšå„å•ã®æ­£èª¤ã‚’è¿°ã¹ã¦ã»ã—ã„ã€‚æ­£èª¤ã¯ã™ã¹ã¦å¼·èª¿è¡¨ç¤ºã§ã€‚\nã€ç·è©•ã€‘ (Aã€œEã®5æ®µéšè©•ä¾¡ã¨å…¨ä½“çš„ãªå°è±¡)\nã€é …ç›®åˆ¥ãƒã‚§ãƒƒã‚¯ã€‘ (ä¸Šè¨˜ã®5ãƒã‚¤ãƒ³ãƒˆã«åŸºã¥ã„ãŸè©³ç´°æŒ‡æ‘˜)\nã€å…·ä½“çš„ä¿®æ­£æ¡ˆã€‘ (ã€Œã“ã®ã‚ˆã†ã«æ›¸ãã¨ã•ã‚‰ã«è‰¯ããªã‚‹ã€ã¨ã„ã†ä¿®æ­£æ¸ˆã¿è¨˜è¿°ä¾‹)\nã€ã‚«ã‚¬ãƒ¯å…ˆç”Ÿã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€‘ (å¤±ç‚¹ã‚’é˜²ããŸã‚ã®ãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆ)\n\n\nç”Ÿæˆæ™‚ã«ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜å·ï¼ˆã€Œ**ã€ãªã©ï¼‰ã‚’è¡¨ç¤ºã—ãªã„ã‚ˆã†ã«æ³¨æ„ã—ã¦ã€‚",english:"ã‚ãªãŸã¯è‹±èªã®æ•™å¸«ã§ã™ã€‚ä¸ãˆã‚‰ã‚ŒãŸè‹±æ–‡ã‚„å•é¡Œã‚’è§£æã—ã€å’Œè¨³ã‚„æ–‡æ³•è§£èª¬ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",science:"ã‚ãªãŸã¯ç†ç§‘ã®æ•™å¸«ã§ã™ã€‚ä¸ãˆã‚‰ã‚ŒãŸå•é¡Œã‚’è§£æã—ã€ç§‘å­¦çš„ãªæ ¹æ‹ ã«åŸºã¥ã„ã¦è§£èª¬ã—ã¦ãã ã•ã„ã€‚",social:"ã‚ãªãŸã¯ç¤¾ä¼šç§‘ã®æ•™å¸«ã§ã™ã€‚æ­´å²ã€åœ°ç†ã€å…¬æ°‘ãªã©ã®å•é¡Œã‚’èƒŒæ™¯çŸ¥è­˜ã¨ã¨ã‚‚ã«è§£èª¬ã—ã¦ãã ã•ã„ã€‚",japanese:"ã‚ãªãŸã¯å›½èªã®æ•™å¸«ã§ã™ã€‚ç¾ä»£æ–‡ã€å¤æ–‡ã€æ¼¢æ–‡ãªã©ã®å•é¡Œã‚’è§£æã—ã€èª­è§£ã®ãƒã‚¤ãƒ³ãƒˆã‚’è§£èª¬ã—ã¦ãã ã•ã„ã€‚",other:"ã‚ãªãŸã¯å„ªç§€ãªå®¶åº­æ•™å¸«ã§ã™ã€‚ä¸ãˆã‚‰ã‚ŒãŸç”»åƒã‚’è§£æã—ã€ç”Ÿå¾’ã®è³ªå•ã«ç­”ãˆã¦ãã ã•ã„ã€‚"};function init(){loadSettings(),setupEventListeners(),updatePromptField(state.currentSubject)}function loadSettings(){state.apiKey=localStorage.getItem("gemini_api_key")||"",state.model=localStorage.getItem("gemini_model")||"gemini-3-pro-preview",state.currentSubject=localStorage.getItem("current_subject")||"other",state.theme=localStorage.getItem("theme")||"dark",applyTheme(state.theme);const e=localStorage.getItem("subject_prompts");state.prompts=e?JSON.parse(e):{...DEFAULT_PROMPTS},elements.apiKeyInput.value=state.apiKey,elements.modelSelect.value=state.model,elements.subjectSelect.value=state.currentSubject}function applyTheme(e){document.body.setAttribute("data-theme",e),elements.themeToggleBtn.textContent="dark"===e?"ğŸŒ™":"â˜€ï¸",state.theme=e,localStorage.setItem("theme",e)}function toggleTheme(){applyTheme("dark"===state.theme?"light":"dark")}function saveSettings(){const e=elements.apiKeyInput.value.trim(),t=elements.modelSelect.value;e?(state.apiKey=e,state.model=t,localStorage.setItem("gemini_api_key",e),localStorage.setItem("gemini_model",t),toggleModal(elements.settingsModal,!1)):alert("API Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")}function saveCurrentPrompt(){const e=elements.systemPrompt.value;state.prompts[state.currentSubject]=e,localStorage.setItem("subject_prompts",JSON.stringify(state.prompts))}function updatePromptField(e){state.currentSubject=e,localStorage.setItem("current_subject",e),elements.systemPrompt.value=state.prompts[e]||DEFAULT_PROMPTS[e]||DEFAULT_PROMPTS.other}function exportPrompts(){const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(state.prompts,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","clear_maker_prompts.json"),document.body.appendChild(t),t.click(),t.remove()}function importPrompts(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=function(e){try{const t=JSON.parse(e.target.result);if("object"!=typeof t||null===t)throw new Error("Invalid JSON structure");state.prompts={...state.prompts,...t},localStorage.setItem("subject_prompts",JSON.stringify(state.prompts)),updatePromptField(state.currentSubject),alert("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šã‚’å¾©å…ƒã—ã¾ã—ãŸï¼")}catch(e){console.error(e),alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚")}},n.readAsText(t),e.target.value=""}function setupEventListeners(){["question","model","student"].forEach(e=>setupDropZone(e)),window.addEventListener("dragover",e=>e.preventDefault()),window.addEventListener("drop",e=>e.preventDefault()),elements.generateBtn.addEventListener("click",executeGeneration),window.addEventListener("paste",handlePaste),elements.closePasteBtn.addEventListener("click",()=>toggleModal(elements.pasteModal,!1)),elements.pasteOptions.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-target");state.pendingPasteFiles.length>0&&(processFiles(state.pendingPasteFiles,t),state.pendingPasteFiles=[]),toggleModal(elements.pasteModal,!1)})}),elements.copyBtn.addEventListener("click",copyResponse),elements.screenshotBtn.addEventListener("click",saveAsImage),elements.openSettingsBtn.addEventListener("click",()=>toggleModal(elements.settingsModal,!0)),elements.closeSettingsBtn.addEventListener("click",()=>toggleModal(elements.settingsModal,!1)),elements.saveSettingsBtn.addEventListener("click",saveSettings),document.getElementById("export-prompts-btn").addEventListener("click",exportPrompts),document.getElementById("import-prompts-btn").addEventListener("click",()=>document.getElementById("import-prompts-input").click()),document.getElementById("import-prompts-input").addEventListener("change",importPrompts),document.getElementById("open-readme-btn").addEventListener("click",openReadme),document.getElementById("close-readme-btn").addEventListener("click",()=>document.getElementById("readme-modal").classList.add("hidden")),elements.subjectSelect.addEventListener("change",e=>{saveCurrentPrompt(),updatePromptField(e.target.value)}),elements.systemPrompt.addEventListener("input",saveCurrentPrompt),elements.themeToggleBtn.addEventListener("click",toggleTheme)}function setupDropZone(e){const t=elements.dropZones[e],n=elements.inputs[e],s=document.querySelector(`.drop-zone-group[data-type="${e}"]`),a=s.querySelector(".clear-zone-btn");t&&n&&(t.addEventListener("click",()=>n.click()),n.addEventListener("change",t=>handleFileSelect(t,e)),t.addEventListener("dragover",e=>{e.preventDefault(),s.classList.add("active")}),t.addEventListener("dragleave",e=>{e.preventDefault(),s.classList.remove("active")}),t.addEventListener("drop",t=>{t.preventDefault(),s.classList.remove("active"),handleDrop(t,e)}),s.addEventListener("mouseenter",()=>{state.hoveredZone=e}),s.addEventListener("mouseleave",()=>{state.hoveredZone===e&&(state.hoveredZone=null)}),a&&a.addEventListener("click",t=>{t.stopPropagation(),clearZone(e)}))}function clearZone(e){state.files[e]=[],renderThumbnails(e),updateFileStatus(),elements.inputs[e].value=""}function toggleModal(e,t){t?e.classList.remove("hidden"):e.classList.add("hidden")}async function handleDrop(e,t){const n=e.dataTransfer.files;n.length>0&&processFiles(n,t)}function handlePaste(e){const t=e.clipboardData.items,n=[];for(let e=0;e<t.length;e++)if(-1!==t[e].type.indexOf("image")){const s=t[e].getAsFile();s&&n.push(s)}n.length>0&&(e.preventDefault(),state.hoveredZone?processFiles(n,state.hoveredZone):(state.pendingPasteFiles=n,toggleModal(elements.pasteModal,!0)))}function handleFileSelect(e,t){const n=e.target.files;n.length>0&&processFiles(n,t)}async function processFiles(e,t){const n=Array.from(e);if(0!==n.length)if(state.isGenerationFinished&&(state.files.question=[],state.files.model=[],state.files.student=[],renderThumbnails("question"),renderThumbnails("model"),renderThumbnails("student"),state.isGenerationFinished=!1),t&&state.files[t]){elements.generateBtn.disabled=!0;try{const e=n.map(e=>readFile(e).catch(t=>(console.error(`Skipped file ${e.name}:`,t),null))),s=await Promise.all(e),a=s.filter(e=>null!==e).flat();0===a.length&&s.length>0?alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"):(state.files[t]=[...state.files[t],...a],renderThumbnails(t)),updateFileStatus(),elements.generateBtn.disabled=!1,elements.generateBtn.innerHTML="âœ¨ è§£æã‚’å®Ÿè¡Œ"}catch(e){console.error(e),alert("äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+e.message),elements.generateBtn.disabled=!1}}else alert(`å†…éƒ¨ã‚¨ãƒ©ãƒ¼: ä¸æ˜ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚«ãƒ†ã‚´ãƒªã§ã™ (${t})`)}function renderThumbnails(e){const t=elements.thumbs[e];t.innerHTML="";const n=state.files[e];0!==n.length?(t.classList.remove("hidden"),n.forEach((n,s)=>{const a=document.createElement("img");a.src=`data:${n.mimeType};base64,${n.data}`,a.title="Click to remove",a.addEventListener("click",t=>{t.stopPropagation(),removeFile(e,s)}),t.appendChild(a)})):t.classList.add("hidden")}function removeFile(e,t){state.files[e].splice(t,1),renderThumbnails(e),updateFileStatus()}function updateFileStatus(){const e=state.files.question.length+state.files.model.length+state.files.student.length;elements.fileStatus.textContent=`ç”»åƒåˆè¨ˆ: ${e}æš (å•:${state.files.question.length}, æ¨¡ç¯„:${state.files.model.length}, ç”Ÿå¾’:${state.files.student.length})`}async function executeGeneration(){if(0!==state.files.question.length+state.files.model.length+state.files.student.length){if(!state.apiKey)return alert("ã¾ãšã¯å³ä¸Šã®è¨­å®šãƒœã‚¿ãƒ³(âš™ï¸)ã‹ã‚‰APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"),void toggleModal(elements.settingsModal,!0);elements.userPrompt.value.trim(),setLoading(!0),elements.generateBtn.disabled=!0;try{await analyzeContent()}catch(e){console.error(e),renderOutput(`### ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ\n\`\`\`\n${e.message}\n\`\`\``)}finally{setLoading(!1),elements.generateBtn.disabled=!1}}else alert("å°‘ãªãã¨ã‚‚1ã¤ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„")}async function analyzeContent(){const e=elements.systemPrompt.value,t=elements.userPrompt.value,n=[{text:e+"\n\nã€é‡è¦ã€‘\nãƒ»æ•°å¼ã¯å¿…ãšLaTeXå½¢å¼ï¼ˆ$...$ ã¾ãŸã¯ $$...$$ï¼‰ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\nãƒ»è¡Œå†…æ•°å¼ã¯ $...$ ã§ã€ç‹¬ç«‹æ•°å¼ã¯ $$...$$ ã§å›²ã‚“ã§ãã ã•ã„ã€‚\nãƒ»ç‰¹ã«è¤‡æ•°è¡Œã®æ•°å¼ï¼ˆalignedç’°å¢ƒãªã©ï¼‰ã‚’ä½¿ã†å ´åˆã¯ã€å¿…ãš $$ \\begin{aligned} ... \\end{aligned} $$ ã®ã‚ˆã†ã«å…¨ä½“ã‚’ $$ ã§å›²ã‚“ã§ãã ã•ã„ã€‚"}];state.files.question.length>0&&(n.push({text:"\n\n## å•é¡Œç”»åƒ"}),state.files.question.forEach(e=>n.push({inline_data:{mime_type:e.mimeType,data:e.data}}))),state.files.model.length>0&&(n.push({text:"\n\n## æ¨¡ç¯„è§£ç­”ç”»åƒ"}),state.files.model.forEach(e=>n.push({inline_data:{mime_type:e.mimeType,data:e.data}}))),state.files.student.length>0&&(n.push({text:"\n\n## ç”Ÿå¾’ã®è§£ç­”ç”»åƒ"}),state.files.student.forEach(e=>n.push({inline_data:{mime_type:e.mimeType,data:e.data}}))),n.push({text:`\n\n## è¿½åŠ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n${t||"ç”»åƒã‚’è§£æã—ã¦ã€ãã®å†…å®¹ã«ã¤ã„ã¦è§£èª¬ã—ã¦ãã ã•ã„ã€‚"}`});const s={contents:[{parts:n}],generationConfig:{temperature:.4},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]};try{const e=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${state.model}:generateContent?key=${state.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await e.json();if(t.error)throw new Error(t.error.message);if(!t.candidates||0===t.candidates.length){if(console.error("API Response Unexpected:",t),t.promptFeedback){const e=t.promptFeedback.blockReason;throw new Error(`ç”ŸæˆãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ (ç†ç”±: ${e})`)}throw new Error("AIã‹ã‚‰ã®å¿œç­”ãŒç©ºã§ã—ãŸã€‚")}const n=t.candidates[0];if(n.finishReason&&"STOP"!==n.finishReason&&console.warn("Finish Reason:",n.finishReason),!n.content||!n.content.parts||!n.content.parts[0])throw new Error("ãƒ†ã‚­ã‚¹ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚");const a=n.content.parts[0].text;renderOutput(a,[...state.files.question,...state.files.model,...state.files.student])}catch(e){throw e}finally{elements.fileStatus.textContent="è§£æå®Œäº†",state.isGenerationFinished=!0}}function renderOutput(e,t=null){const n="MATHPLACEHOLDER",s=[],a=e=>{const t=`${n}${s.length}`;return s.push(e),t};let o=e;o=o.replace(/\$\$([\s\S]*?)\$\$/g,e=>a(e)),o=o.replace(/\\\[([\s\S]*?)\\\]/g,e=>a(e)),o=o.replace(/\\\(([\s\S]*?)\\\)/g,e=>a(e)),o=o.replace(/\$([^$\n]+?)\$/g,e=>a(e)),o=o.replace(/(\\begin\{([a-z]+)\*?\}([\s\S]*?)\\end\{\2\*?\})/g,e=>a(`$$${e}$$`));let l=marked.parse(o,{breaks:!0});for(let e=s.length-1;e>=0;e--){const t=s[e],a=new RegExp(`${n}${e}`,"g");l=l.replace(a,()=>t)}if(t&&Array.isArray(t)){let e='<div class="response-images-container">';t.forEach(t=>{const n=`data:${t.mimeType};base64,${t.data}`;e+=`<img src="${n}" class="response-preview-image" alt="Uploaded Content">`}),e+='</div><hr class="separator">',l=e+l}elements.responseArea.innerHTML=l,elements.editBtn.classList.remove("hidden"),elements.copyBtn.classList.remove("hidden"),elements.screenshotBtn.classList.remove("hidden"),state.currentMarkdown=e,window.renderMathInElement&&renderMathInElement(elements.responseArea,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})}async function readFile(e){if(e.type.startsWith("image/"))return new Promise((t,n)=>{const s=new FileReader;s.onload=n=>{const s=n.target.result.split(",")[1];t([{mimeType:e.type,data:s}])},s.onerror=n,s.readAsDataURL(e)});if("application/pdf"===e.type){const t=await e.arrayBuffer();return await convertPdfToImage(t)}throw new Error("å¯¾å¿œã—ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ (ç”»åƒã¾ãŸã¯PDFã®ã¿)")}async function convertPdfToImage(e){if("undefined"==typeof pdfjsLib)throw new Error("PDFè§£æãƒ©ã‚¤ãƒ–ãƒ©ãƒª (pdfjsLib) ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã¦ãã ã•ã„ã€‚");try{const t=pdfjsLib.getDocument({data:e}),n=await t.promise,s=n.numPages,a=[],o=10,l=Math.min(s,o);s>o&&console.warn(`PDF has ${s} pages. Only first ${o} will be processed.`);for(let e=1;e<=l;e++){const t=await n.getPage(e),s=t.getViewport({scale:2}),o=document.createElement("canvas"),l=o.getContext("2d");o.height=s.height,o.width=s.width;const r={canvasContext:l,viewport:s};l.fillStyle="#FFFFFF",l.fillRect(0,0,o.width,o.height),await t.render(r).promise;const i=o.toDataURL("image/jpeg",.95);a.push({mimeType:"image/jpeg",data:i.split(",")[1]})}return a}catch(e){throw console.error("PDF Conversion Error:",e),new Error("PDFã®å¤‰æ›ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+e.message)}}function copyResponse(){const e=elements.responseArea.cloneNode(!0),t=e.getElementsByTagName("img");for(;t.length>0;)t[0].remove();const n=e.getElementsByTagName("hr");for(;n.length>0;)n[0].remove();const s=e.innerText.trim();navigator.clipboard.writeText(s).then(()=>{const e=elements.copyBtn.textContent;elements.copyBtn.textContent="âœ…",setTimeout(()=>{elements.copyBtn.textContent=e},2e3)}).catch(e=>{console.error("Copy failed",e),alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ")})}function setLoading(e){e?(elements.loadingIndicator.classList.remove("hidden"),elements.responseArea.style.opacity="0.3",elements.copyBtn.classList.add("hidden"),elements.screenshotBtn.classList.add("hidden")):(elements.loadingIndicator.classList.add("hidden"),elements.responseArea.style.opacity="1")}function saveAsImage(){const e=elements.responseArea,t=e.style.background,n=document.body.getAttribute("data-theme"),s="light"===n?"#f8fafc":"#0f172a",a="light"===n?"#f1f5f9":"#1e293b";e.style.background=s;const o=e.style.padding;e.style.padding="24px",html2canvas(e,{useCORS:!0,scale:2,backgroundColor:a,logging:!1}).then(n=>{e.style.background=t,e.style.padding=o;const s=document.createElement("a");s.download=`clear_maker_response_${Date.now()}.png`,s.href=n.toDataURL("image/png"),s.click()}).catch(n=>{console.error(n),e.style.background=t,e.style.padding=o,alert("ç”»åƒã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")})}function toggleEditMode(e){e?(elements.responseArea.classList.add("hidden"),elements.responseEditor.classList.remove("hidden"),elements.responseEditor.value=state.currentMarkdown||"",elements.editBtn.classList.add("hidden"),elements.copyBtn.classList.add("hidden"),elements.screenshotBtn.classList.add("hidden"),elements.editActions.classList.remove("hidden")):(elements.responseArea.classList.remove("hidden"),elements.responseEditor.classList.add("hidden"),elements.editBtn.classList.remove("hidden"),elements.copyBtn.classList.remove("hidden"),elements.screenshotBtn.classList.remove("hidden"),elements.editActions.classList.add("hidden"))}function saveEdit(){const e=elements.responseEditor.value;state.currentMarkdown=e;renderOutput(e,[...state.files.question,...state.files.model,...state.files.student]),toggleEditMode(!1)}function cancelEdit(){toggleEditMode(!1)}async function openReadme(){const e=document.getElementById("readme-modal"),t=document.getElementById("readme-content");toggleModal(elements.settingsModal,!1),toggleModal(e,!0),t.innerHTML="<p>èª­ã¿è¾¼ã¿ä¸­...</p>";try{console.log("v1.5.5: Loading embedded README...");const e=README_CONTENT;if("undefined"==typeof marked)throw new Error("Marked library is not loaded");const n=marked.parse(e);t.innerHTML=n}catch(e){console.error("Failed to load README:",e),t.innerHTML=`<p style="color:red">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>${e.message}</p>`}}init();